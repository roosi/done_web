<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>done</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel="stylesheet" href="css/jquery.mobile-1.4.2.min.css">
    <link rel="stylesheet" href="css/jqm-datebox.min.css">
    <link rel="stylesheet" href="css/done.css">
    <script type="text/javascript" src="js/jquery-2.1.0.min.js"></script>
    <script type="text/javascript" src="js/jquery.mobile-1.4.2.min.js"></script>
    <script type="text/javascript" src="js/jqm-datebox.core.min.js"></script>
    <script type="text/javascript" src="js/jqm-datebox.mode.calbox.min.js"></script>
    <script type="text/javascript" src="js/jqm-datebox.mode.datebox.min.js"></script>
    <script type='text/javascript' src='js/knockout-3.1.0.js'></script>
</head>
    
<body>

<div data-role="page" id="tasks">
    <div data-role="header" data-position="fixed">
        <div style="text-align:center;">
            <select name="select-choice-0" id="select-choice-0"
                    data-bind="options: taskLists,
                               optionsText: 'name',
                               value: selectedTaskList">
            </select>
        </div>
    </div><!-- /header -->

    <div data-role="content">
        <ul data-role="listview" id="tasks-list" data-bind="foreach: tasks">
            <li data-bind="click: $root.navigateToTask">
                <img class="status-image" src="http://placehold.it/100x100">
                <p class="status-date" data-bind="text: date"></p>
                <p class="task-name" data-bind="text: name"></p>
                <p class="task-notes" data-bind="text: notes"></p>
            </li>
        </ul>
    </div><!-- /content -->

    <div data-id="tasks-footer" data-role="footer" data-position="fixed">
        <h1>powered by Google</h1>
    </div><!-- /footer -->

</div>

<div data-role="page" id="task" data-bind="with: selectedTask" data-add-back-btn="true">
    <div data-role="header">
        <a href="#" data-icon="back" data-rel="back">Back</a>
        <h1 data-bind="text: name"></h1>
        <button class="ui-btn-right ui-btn ui-btn-inline ui-mini ui-corner-all ui-btn-icon-right ui-icon-check">Save
</button>
    </div><!-- /header -->

    <div data-role="content" class="task-content">
        <input data-bind="value: name"></input>
        <input id="due-date" data-bind="value: date" type="date" data-role="datebox"
               data-options='{"mode":"calbox","useFocus": true}'></input>
        <textarea data-bind="text: notes"></textarea>
    </div><!-- /content -->

    <div data-id="task-footer" data-role="footer" data-position="fixed" style="text-align:center;">
        <div class="ui-nodisc-icon ui-alt-icon"><!-- Classes added to the wrapper -->
            <a href="#" class="ui-btn ui-shadow ui-corner-all ui-icon-delete ui-btn-icon-notext ui-btn-inline">Delete</a>
            <a href="#" class="ui-btn ui-shadow ui-corner-all ui-icon-plus ui-btn-icon-notext ui-btn-inline">Plus</a>
            <a href="#" class="ui-btn ui-shadow ui-corner-all ui-icon-minus ui-btn-icon-notext ui-btn-inline">Minus</a>
            <a href="#" class="ui-btn ui-shadow ui-corner-all ui-icon-check ui-btn-icon-notext ui-btn-inline">Check</a>
        </div>
    </div><!-- /footer -->
</div>

</body>
    
<script>
function TaskListsViewModel() {
    // model
    var self = this;
    self.taskLists = ko.observableArray([
        { name: 'task list 1'}, { name: 'task list 2'}, { name: 'task list 3'}, { name: 'task list 4'}]);
    self.selectedTaskList = ko.observable();
    self.tasks = ko.observableArray();
    self.selectedTask = ko.observable();

    self.selectedTaskList.subscribe(function(newValue) {
        console.log("selectedTaskList:" + newValue.name);
        if (newValue != self.selectedTaskList)
        {
            self.navigateToTaskList(newValue);
        }
    });

    // behaviours
    self.navigateToTaskList = function(taskList) {
        console.log("navigateToTaskList:" + taskList.name);

        self.tasks([
            { name: "Task name 1", date:"09.03.2014", notes: "Pellentesque est sem, posuere vitae tincidunt non, cursus ac massa." },
            { name: "Task name 2", date:"11.03.2014", notes: "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Proin lacus felis, porttitor ut tincidunt eget, mattis viverra risus." },
            { name: "Task name 3", date:"14.03.2014", notes: "" },
            { name: "Task name 4", date:"16.03.2014", notes: "" },
            { name: "Task name 5", date:"17.03.2014", notes: "" },
            { name: "Task name 6", date:"21.03.2014", notes: "" },
            { name: "Task name 7", date:"21.03.2014", notes: "" }
        ]);

        $('#tasks-list').listview();
        $('#tasks-list').listview('refresh');
    };

    self.navigateToTask = function(task) {
        console.log("navigateToTask:" + task.name);
        self.selectedTask(task);

        $.mobile.changePage( "#task" );

        $('#task').trigger('create');
        $('#tasks').trigger('create');

        $('#due-date').trigger('datebox', {'method':'set', 'date':'11/03/2014', 'value':"11/03/2014"});
        $('#due-date').trigger('datebox', {'method':'doset'});
    };
};

ko.applyBindings(new TaskListsViewModel());
</script>
</html>
